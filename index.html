<html><head><base href="https://oscillate.io/" /><title>F1dg3t's GameOSC Controller</title><style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
    margin: 0;
    padding: 20px;
    color: #333;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  .main-content {
    display: flex;
    flex: 1;
  }
  .container {
    flex: 1;
    max-width: 800px;
    margin-right: 20px;
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  .controller-visual {
    width: 300px;
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  h1, h2 {
    color: #2c3e50;
    text-align: center;
  }
  .controller-display {
    width: 100%;
    height: 300px;
    background-color: #ecf0f1;
    border: 2px solid #bdc3c7;
    border-radius: 10px;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
  }
  .button, .axis {
    position: absolute;
    background-color: #3498db;
    border-radius: 5px;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 12px;
  }
  .axis {
    background-color: #e74c3c;
  }
  .mapping-list {
    list-style-type: none;
    padding: 0;
  }
  .mapping-item {
    background-color: #ecf0f1;
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .remove-mapping {
    background-color: #e74c3c;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 3px;
    cursor: pointer;
  }
  .add-mapping {
    background-color: #2ecc71;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    margin-top: 20px;
  }
  #controllerInfo {
    text-align: center;
    margin-bottom: 20px;
    font-weight: bold;
  }
  .osc-visual {
    display: flex;
    align-items: center;
    margin-top: 10px;
  }
  .osc-button {
    width: 40px;
    height: 40px;
    background-color: #3498db;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    margin-right: 10px;
  }
  .osc-slider {
    width: 200px;
    height: 20px;
    background-color: #ecf0f1;
    border-radius: 10px;
    position: relative;
  }
  .osc-slider-thumb {
    width: 20px;
    height: 20px;
    background-color: #e74c3c;
    border-radius: 50%;
    position: absolute;
    left: 0;
  }
  .osc-value {
    margin-left: 10px;
    font-weight: bold;
  }
  .ip-input-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 20px;
  }
  .ip-input {
    padding: 10px;
    font-size: 16px;
    border: 1px solid #bdc3c7;
    border-radius: 5px;
    margin-right: 10px;
  }
  .ip-submit {
    background-color: #3498db;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
  }
  .invert-checkbox {
    margin-left: 10px;
  }
  .invert-label {
    font-size: 14px;
    cursor: pointer;
  }
  .controller-input {
    margin-bottom: 10px;
    padding: 5px;
    background-color: #ecf0f1;
    border-radius: 5px;
  }
  .controller-input-value {
    float: right;
    font-weight: bold;
  }
  .footer {
    text-align: center;
    margin-top: 20px;
  }
  .github-icon {
    width: 32px;
    height: 32px;
    opacity: 0.7;
    transition: opacity 0.3s ease;
  }
  .github-icon:hover {
    opacity: 1;
  }
</style></head><body>
  <div class="main-content">
    <div class="container">
      <h1>F1dg3t's GameOSC Controller</h1>
      
      <div class="ip-input-container">
        <input type="text" id="ipInput" class="ip-input" placeholder="Enter local IP address">
        <button id="ipSubmit" class="ip-submit">Set IP</button>
      </div>

      <div id="controllerInfo">No controller detected. Please connect a controller and press any button.</div>
      
      <div class="controller-display" id="controllerDisplay">
        <!-- Controller elements will be dynamically added here -->
      </div>
      
      <h2>Current Mappings</h2>
      <ul class="mapping-list" id="mappingList">
        <!-- Mappings will be dynamically added here -->
      </ul>
      
      <button class="add-mapping" id="addMapping">Add New Mapping</button>
    </div>

    <div class="controller-visual">
      <h2>Controller Inputs</h2>
      <div id="controllerInputs">
        <!-- Controller inputs will be dynamically added here -->
      </div>
    </div>
  </div>

  <div class="footer">
    <a href="#" id="github-link" target="_blank">
      <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" class="github-icon">
    </a>
  </div>

  <script>
    let controller = null;
    const mappings = [];
    let oscIpAddress = null;

    function updateControllerDisplay() {
      const display = document.getElementById('controllerDisplay');
      display.innerHTML = '';
      
      if (controller) {
        controller.buttons.forEach((button, index) => {
          const el = document.createElement('div');
          el.className = 'button';
          el.style.left = (index * 40 + 10) + 'px';
          el.style.top = '10px';
          el.textContent = `B${index}: ${button.value.toFixed(2)}`;
          display.appendChild(el);
        });

        controller.axes.forEach((axis, index) => {
          const el = document.createElement('div');
          el.className = 'axis';
          el.style.left = (index * 80 + 10) + 'px';
          el.style.top = '60px';
          el.textContent = `A${index}: ${axis.toFixed(2)}`;
          display.appendChild(el);
        });
      }
    }

    function updateControllerVisual() {
      const visual = document.getElementById('controllerInputs');
      visual.innerHTML = '';

      if (controller) {
        controller.buttons.forEach((button, index) => {
          const el = document.createElement('div');
          el.className = 'controller-input';
          el.innerHTML = `Button ${index}: <span class="controller-input-value">${button.value.toFixed(2)}</span>`;
          visual.appendChild(el);
        });

        controller.axes.forEach((axis, index) => {
          const el = document.createElement('div');
          el.className = 'controller-input';
          el.innerHTML = `Axis ${index}: <span class="controller-input-value">${axis.toFixed(2)}</span>`;
          visual.appendChild(el);
        });
      }
    }

    function renderMappings() {
      const list = document.getElementById('mappingList');
      list.innerHTML = '';
      mappings.forEach((mapping, index) => {
        const li = document.createElement('li');
        li.className = 'mapping-item';
        li.innerHTML = `
          <div>
            <span>${mapping.controllerInput} â†’ ${mapping.oscAddress}</span>
            <div class="osc-visual">
              ${mapping.type === 'button' ? 
                `<div class="osc-button">0</div>` :
                `<div class="osc-slider"><div class="osc-slider-thumb"></div></div>`
              }
              <span class="osc-value">0</span>
              ${mapping.type === 'axis' ? `
                <label class="invert-label">
                  <input type="checkbox" class="invert-checkbox" data-index="${index}" ${mapping.inverted ? 'checked' : ''}>
                  Invert
                </label>
              ` : ''}
            </div>
          </div>
          <button class="remove-mapping" data-index="${index}">Remove</button>
        `;
        list.appendChild(li);
      });

      // Add event listeners for invert checkboxes
      document.querySelectorAll('.invert-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', (e) => {
          const index = parseInt(e.target.dataset.index);
          mappings[index].inverted = e.target.checked;
        });
      });
    }

    function addMapping() {
      if (!controller) {
        alert('Please connect a controller first.');
        return;
      }
      
      const inputType = prompt('Enter input type (button or axis):');
      if (inputType !== 'button' && inputType !== 'axis') {
        alert('Invalid input type. Please enter "button" or "axis".');
        return;
      }
      
      const inputIndex = parseInt(prompt(`Enter ${inputType} index:`));
      if (isNaN(inputIndex) || inputIndex < 0 || 
          (inputType === 'button' && inputIndex >= controller.buttons.length) ||
          (inputType === 'axis' && inputIndex >= controller.axes.length)) {
        alert('Invalid index.');
        return;
      }
      
      const oscAddress = prompt('Enter OSC address (e.g., "/button/0", "/axis/1"):');
      if (!oscAddress) {
        alert('Invalid OSC address.');
        return;
      }
      
      mappings.push({
        type: inputType,
        controllerInput: `${inputType.charAt(0).toUpperCase() + inputType.slice(1)} ${inputIndex}`,
        oscAddress: oscAddress,
        index: inputIndex,
        inverted: false
      });
      renderMappings();
    }

    function removeMapping(index) {
      mappings.splice(index, 1);
      renderMappings();
    }

    function scanGamepads() {
      const gamepads = navigator.getGamepads();
      for (let i = 0; i < gamepads.length; i++) {
        if (gamepads[i]) {
          return gamepads[i];
        }
      }
      return null;
    }

    function updateGamepadState() {
      controller = scanGamepads();
      if (controller) {
        document.getElementById('controllerInfo').textContent = `Controller detected: ${controller.id}`;
        updateControllerDisplay();
        updateControllerVisual();
        updateMappingVisuals();
      } else {
        document.getElementById('controllerInfo').textContent = 'No controller detected. Please connect a controller and press any button.';
      }
      requestAnimationFrame(updateGamepadState);
    }

    function updateMappingVisuals() {
      const mappingItems = document.querySelectorAll('.mapping-item');
      mappings.forEach((mapping, index) => {
        const item = mappingItems[index];
        const visual = item.querySelector('.osc-visual');
        let value;

        if (mapping.type === 'button') {
          value = controller.buttons[mapping.index].value;
          visual.querySelector('.osc-button').textContent = value.toFixed(2);
        } else {
          value = controller.axes[mapping.index];
          if (mapping.inverted) {
            value = -value;
          }
          const thumb = visual.querySelector('.osc-slider-thumb');
          thumb.style.left = `${((value + 1) / 2) * 180}px`;  // Map -1 to 1 to 0 to 180px
        }

        visual.querySelector('.osc-value').textContent = value.toFixed(2);

        // Here we would send the OSC message if we had a real OSC library
        if (oscIpAddress) {
          console.log(`Sending OSC message to ${oscIpAddress}: ${mapping.oscAddress} ${value}`);
          // In a real implementation, we would use an OSC library to send the message
          // oscLib.send(oscIpAddress, mapping.oscAddress, value);
        }
      });
    }

    window.addEventListener("gamepadconnected", function(e) {
      console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",
        e.gamepad.index, e.gamepad.id,
        e.gamepad.buttons.length, e.gamepad.axes.length);
      updateGamepadState();
    });

    window.addEventListener("gamepaddisconnected", function(e) {
      console.log("Gamepad disconnected from index %d: %s",
        e.gamepad.index, e.gamepad.id);
      controller = null;
      updateControllerDisplay();
      updateControllerVisual();
    });

    document.getElementById('addMapping').addEventListener('click', addMapping);
    
    document.getElementById('mappingList').addEventListener('click', (e) => {
      if (e.target.classList.contains('remove-mapping')) {
        removeMapping(parseInt(e.target.dataset.index));
      }
    });

    document.getElementById('ipSubmit').addEventListener('click', () => {
      const ipInput = document.getElementById('ipInput');
      const ip = ipInput.value.trim();
      if (ip) {
        oscIpAddress = ip;
        alert(`OSC IP address set to: ${oscIpAddress}`);
      } else {
        alert('Please enter a valid IP address');
      }
    });

    updateGamepadState();
  </script>
</body></html>